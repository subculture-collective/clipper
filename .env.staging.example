# Staging Environment Variables
# Copy this file to .env on your staging server and fill in the values
# 
# SECURITY WARNING: Never commit actual secrets to version control!
# See docs/SECRETS_MANAGEMENT.md for best practices
#
# Generate secure passwords with: openssl rand -base64 32

# ============================================================================
# Database Configuration
# ============================================================================
POSTGRES_DB=clipper_staging_db
POSTGRES_USER=clipper_staging
# Generate with: openssl rand -base64 32
POSTGRES_PASSWORD=CHANGEME_SECURE_STAGING_PASSWORD_HERE

# Backend connection settings (Docker network)
DB_HOST=postgres
DB_PORT=5432
DB_USER=clipper_staging
DB_PASSWORD=CHANGEME_SECURE_STAGING_PASSWORD_HERE
DB_NAME=clipper_staging_db
DB_SSLMODE=require

# ============================================================================
# Redis Configuration
# ============================================================================
REDIS_HOST=redis
REDIS_PORT=6379
# Generate with: openssl rand -base64 32
REDIS_PASSWORD=CHANGEME_SECURE_REDIS_PASSWORD
REDIS_DB=0
REDIS_MAX_MEMORY=256mb
REDIS_EVICTION_POLICY=allkeys-lru

# ============================================================================
# OpenSearch Configuration
# ============================================================================
OPENSEARCH_URL=http://opensearch:9200
OPENSEARCH_USERNAME=admin
OPENSEARCH_PASSWORD=CHANGEME_OPENSEARCH_PASSWORD
OPENSEARCH_INSECURE_SKIP_VERIFY=false
# Disable security plugin for staging (enable for production-like testing)
OPENSEARCH_DISABLE_SECURITY=true

# ============================================================================
# Application Configuration
# ============================================================================
PORT=8080
GIN_MODE=release
LOG_LEVEL=debug
ENVIRONMENT=staging

# ============================================================================
# JWT Configuration
# ============================================================================
# Generate RSA key pair with:
#   openssl genrsa -out private.pem 2048
#   openssl rsa -in private.pem -pubout -out public.pem
# Then copy the entire content (including -----BEGIN/END----- lines)
JWT_PRIVATE_KEY=CHANGEME_PASTE_STAGING_PRIVATE_KEY_HERE
JWT_PUBLIC_KEY=CHANGEME_PASTE_STAGING_PUBLIC_KEY_HERE
# Token expiration (in hours) - shorter for staging
JWT_ACCESS_TOKEN_EXPIRY=24
JWT_REFRESH_TOKEN_EXPIRY=168

# ============================================================================
# Twitch API Configuration
# ============================================================================
# Get credentials from: https://dev.twitch.tv/console/apps
# Use separate staging app for testing
TWITCH_CLIENT_ID=CHANGEME_TWITCH_STAGING_CLIENT_ID
TWITCH_CLIENT_SECRET=CHANGEME_TWITCH_STAGING_CLIENT_SECRET
TWITCH_REDIRECT_URI=https://staging.clpr.tv/api/v1/auth/twitch/callback

# ============================================================================
# CORS Configuration
# ============================================================================
# Comma-separated list of allowed origins
CORS_ALLOWED_ORIGINS=https://staging.clpr.tv,https://staging.clipper.app

# ============================================================================
# Cookie Security
# ============================================================================
# Session cookie configuration
COOKIE_DOMAIN=staging.clpr.tv
COOKIE_SECURE=true
COOKIE_HTTPONLY=true
COOKIE_SAMESITE=lax
COOKIE_MAX_AGE=86400

# ============================================================================
# Observability & Monitoring
# ============================================================================
# Sentry Configuration
# Create separate staging project at https://sentry.io/
SENTRY_DSN=
SENTRY_ENVIRONMENT=staging
SENTRY_ENABLED=true
# Higher sample rate for staging (more data for debugging)
SENTRY_TRACES_SAMPLE_RATE=0.5
SENTRY_RELEASE=

# OpenTelemetry configuration
OTEL_ENABLED=true
OTEL_SERVICE_NAME=clipper-backend-staging
OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4318
OTEL_TRACES_SAMPLER=parentbased_traceidratio
OTEL_TRACES_SAMPLER_ARG=0.5

# Prometheus metrics
METRICS_ENABLED=true
METRICS_PORT=9090

# ============================================================================
# Backup Configuration
# ============================================================================
BACKUP_ENABLED=true
BACKUP_RETENTION_DAYS=7
BACKUP_SCHEDULE="0 3 * * *"  # Daily at 3 AM
BACKUP_DESTINATION=/var/backups/clipper-staging

# ============================================================================
# Rate Limiting
# ============================================================================
RATE_LIMIT_ENABLED=true
# More lenient for staging testing
RATE_LIMIT_REQUESTS_PER_MINUTE=120
RATE_LIMIT_BURST=20

# ============================================================================
# Security Headers
# ============================================================================
SECURITY_HEADERS_ENABLED=true
HSTS_MAX_AGE=31536000
CSP_ENABLED=true

# ============================================================================
# Feature Flags
# ============================================================================
# Enable features for testing before production
FEATURE_SEMANTIC_SEARCH=true
FEATURE_PREMIUM_SUBSCRIPTIONS=true
FEATURE_EMAIL_NOTIFICATIONS=true
FEATURE_PUSH_NOTIFICATIONS=true
FEATURE_ANALYTICS=true
FEATURE_MODERATION=true
FEATURE_DISCOVERY_LISTS=true

# ============================================================================
# Stripe Configuration (Test Mode)
# ============================================================================
# Use Stripe test keys for staging
STRIPE_SECRET_KEY=sk_test_CHANGEME
STRIPE_WEBHOOK_SECRET=whsec_CHANGEME
STRIPE_PRO_MONTHLY_PRICE_ID=price_CHANGEME
STRIPE_PRO_YEARLY_PRICE_ID=price_CHANGEME

# ============================================================================
# Email Configuration
# ============================================================================
# SendGrid for staging notifications
SENDGRID_API_KEY=CHANGEME_SENDGRID_KEY
SENDGRID_FROM_EMAIL=staging@clipper.app
SENDGRID_FROM_NAME=Clipper Staging

# ============================================================================
# Base URL Configuration
# ============================================================================
BASE_URL=https://staging.clpr.tv

# ============================================================================
# Staging-Specific Settings
# ============================================================================
# Enable verbose logging for debugging
DEBUG_MODE=true
VERBOSE_LOGGING=true

# Allow test users to bypass certain validations
TEST_MODE_ENABLED=true

# Reset data periodically (optional)
AUTO_RESET_ENABLED=false
AUTO_RESET_SCHEDULE="0 0 * * 0"  # Weekly on Sunday

# ============================================================================
# Notes
# ============================================================================
#
# Staging Environment Purpose:
# - Test deployments before production
# - Validate database migrations
# - Test new features with real-like data
# - Performance testing and load testing
# - Integration testing with external services
#
# Key Differences from Production:
# - Separate database and credentials
# - Test API keys for third-party services
# - More verbose logging and monitoring
# - Feature flags enabled for testing
# - Shorter token expiration for testing
# - More lenient rate limits
#
# Security Notes:
# - Use separate credentials from production
# - Enable SSL/TLS certificates
# - Use strong passwords even for staging
# - Rotate credentials regularly
# - Keep staging data non-sensitive
#
