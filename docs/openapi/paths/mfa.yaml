enroll:
  post:
    tags:
      - MFA
    summary: Enroll in MFA
    description: |
      Generate TOTP secret and QR code for MFA enrollment.
      
      **Security Note**: This endpoint returns sensitive cryptographic secrets that should be:
      - Transmitted only over HTTPS
      - Never logged or cached
      - Stored securely by the client
      - Displayed to the user only once
      
      The backup codes should be stored securely and shown to the user for offline recovery.
    operationId: mfaEnroll
    security:
      - BearerAuth: []
    responses:
      '200':
        description: MFA enrollment initiated
        content:
          application/json:
            schema:
              type: object
              properties:
                secret:
                  type: string
                  description: TOTP secret (sensitive - handle securely)
                qr_code:
                  type: string
                  description: QR code data URL for easy setup
                backup_codes:
                  type: array
                  items:
                    type: string
                  description: One-time backup codes for account recovery
      '400':
        description: MFA already enabled
      '401':
        description: Not authenticated

verify-enrollment:
  post:
    tags:
      - MFA
    summary: Verify MFA enrollment
    description: Complete MFA enrollment by verifying TOTP code
    operationId: mfaVerifyEnrollment
    security:
      - BearerAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required:
              - code
            properties:
              code:
                type: string
                pattern: '^\d{6}$'
    responses:
      '200':
        description: MFA enabled successfully
      '400':
        description: Invalid code
      '401':
        description: Not authenticated

status:
  get:
    tags:
      - MFA
    summary: Get MFA status
    description: Check if MFA is enabled for current user
    operationId: mfaStatus
    security:
      - BearerAuth: []
    responses:
      '200':
        description: MFA status
        content:
          application/json:
            schema:
              type: object
              properties:
                enabled:
                  type: boolean
                backup_codes_remaining:
                  type: integer
      '401':
        description: Not authenticated

disable:
  post:
    tags:
      - MFA
    summary: Disable MFA
    description: |
      Disable multi-factor authentication.
      Requires verification with either a TOTP code or a backup code.
    operationId: mfaDisable
    security:
      - BearerAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required:
              - code
            properties:
              code:
                type: string
                description: Either a 6-digit TOTP code or a backup code
                oneOf:
                  - type: string
                    pattern: '^\d{6}$'
                    description: 6-digit TOTP code
                  - type: string
                    pattern: '^[A-Z0-9]{8}$'
                    description: 8-character backup code
    responses:
      '200':
        description: MFA disabled successfully
      '400':
        description: Invalid code
      '401':
        description: Not authenticated
