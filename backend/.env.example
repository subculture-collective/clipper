# ============================================================================
# Backend Environment Variables (Development)
# ============================================================================
# This file contains all required environment variables for local development.
# Copy this file to .env and fill in the values.
#
# SECURITY WARNING: Never commit .env files with actual values!
# See docs/CI_CD_SECRETS.md for production setup.
#

# ============================================================================
# Server Configuration
# ============================================================================
PORT=8080
# Gin mode: debug, release, test
GIN_MODE=debug
# Base URL for the application (used in sitemap and social meta tags)
BASE_URL=http://localhost:5173
# Environment: development, staging, production
ENVIRONMENT=development
# Path to documentation directory (relative to backend directory)
# Default: ../docs (points to project root docs directory)
DOCS_PATH=../docs

# ============================================================================
# Database Configuration
# ============================================================================
DB_HOST=localhost
DB_PORT=5436
DB_USER=clipper
DB_PASSWORD=clipper_password
DB_NAME=clipper_db
DB_SSLMODE=disable

# ============================================================================
# Redis Configuration
# ============================================================================
REDIS_HOST=localhost
REDIS_PORT=6379
# Leave empty for no password (local development)
REDIS_PASSWORD=
REDIS_DB=0

# ============================================================================
# JWT Configuration
# ============================================================================
# Generate RSA key pair with: openssl genrsa -out private.pem 2048 && openssl rsa -in private.pem -pubout -out public.pem
# Then copy the entire content (including -----BEGIN/END----- lines) into these variables
# For development, leave empty and the app will generate a new pair on startup
JWT_PRIVATE_KEY=
JWT_PUBLIC_KEY=

# ============================================================================
# MFA Configuration
# ============================================================================
# MFA_ENCRYPTION_KEY is required for the Multi-Factor Authentication system
# Generate a 32-byte random key using: openssl rand -base64 32
# This key is used for AES-256 encryption of sensitive MFA authentication data
# In production, this must be managed via Vault at kv/clipper/backend
MFA_ENCRYPTION_KEY=

# ============================================================================
# MFA Configuration
# ============================================================================
# 32-byte base64-encoded key for AES-256 encryption of MFA secrets
# Generate with: openssl rand -base64 32
# IMPORTANT: In production, this MUST be managed via Vault (kv/data/clipper/backend)
MFA_ENCRYPTION_KEY=

# ============================================================================
# Twitch API Configuration
# ============================================================================
# Get credentials from: https://dev.twitch.tv/console/apps
# 1. Register a new application
# 2. Copy the Client ID
# 3. Generate a Client Secret
# Required for clip fetching and syncing features
TWITCH_CLIENT_ID=your-twitch-client-id
TWITCH_CLIENT_SECRET=your-twitch-client-secret
TWITCH_REDIRECT_URI=http://localhost:8080/api/v1/auth/twitch/callback

# ============================================================================
# CORS Configuration
# ============================================================================
# Comma-separated list of allowed origins for CORS
CORS_ALLOWED_ORIGINS=http://localhost:5173,http://localhost:3000

# ============================================================================
# Logging
# ============================================================================
# Log level: debug, info, warn, error
LOG_LEVEL=debug

# ============================================================================
# OpenSearch Configuration (Full-Text Search)
# ============================================================================
OPENSEARCH_URL=http://localhost:9200
OPENSEARCH_USERNAME=
OPENSEARCH_PASSWORD=
# WARNING: Set to false in production to enable TLS certificate verification
OPENSEARCH_INSECURE_SKIP_VERIFY=true

# ============================================================================
# Multi-Factor Authentication (MFA)
# ============================================================================
# AES-256 encryption key for encrypting MFA secrets and OTP backup codes
# REQUIRED: Must be exactly 32 bytes when decoded (e.g., 44 characters in base64)
# Generate with: openssl rand -base64 32
# This is managed by Vault in production environments
MFA_ENCRYPTION_KEY=

# ============================================================================
# Stripe Configuration (Payment Processing)
# ============================================================================
# Get credentials from: https://dashboard.stripe.com/test/apikeys
# IMPORTANT: Use test mode keys by default for security
# 1. Get your test secret key from the Stripe Dashboard
# 2. Create products and prices in test mode
# 3. Set up webhook endpoint and get webhook secret
STRIPE_SECRET_KEY=sk_test_your_stripe_secret_key
STRIPE_WEBHOOK_SECRET=whsec_your_webhook_secret
# Optional: Stripe may provide multiple signing secrets per endpoint. Use these for rotations.
STRIPE_WEBHOOK_SECRET_ALT=
# Comma-separated list for any additional webhook secrets to trust.
STRIPE_WEBHOOK_SECRETS=
# Create these price IDs in Stripe Dashboard under Products
STRIPE_PRO_MONTHLY_PRICE_ID=price_your_monthly_price_id
STRIPE_PRO_YEARLY_PRICE_ID=price_your_yearly_price_id
# URLs for redirect after checkout
STRIPE_SUCCESS_URL=http://localhost:5173/subscription/success
STRIPE_CANCEL_URL=http://localhost:5173/subscription/cancel
# Enable Stripe Tax for automatic tax calculation (requires Stripe Tax setup)
# See: https://stripe.com/tax for setup instructions
STRIPE_TAX_ENABLED=false
# Enable invoice PDF delivery via email when invoices are finalized
STRIPE_INVOICE_PDF_ENABLED=false

# ============================================================================
# Sentry Configuration (Error Tracking & Performance Monitoring)
# ============================================================================
# Get DSN from: https://sentry.io/ (create a new project for backend)
# Leave SENTRY_ENABLED=false for development unless testing error tracking
SENTRY_ENABLED=false
SENTRY_DSN=
SENTRY_ENVIRONMENT=development
SENTRY_RELEASE=
# Sample rate for performance monitoring (0.0 to 1.0)
# Set to 1.0 for development, lower in production (e.g., 0.1 = 10%)
SENTRY_TRACES_SAMPLE_RATE=1.0

# ============================================================================
# Email Notifications Configuration (SendGrid)
# ============================================================================
# Get API key from: https://app.sendgrid.com/settings/api_keys
# Leave EMAIL_ENABLED=false for development unless testing email notifications
EMAIL_ENABLED=false
SENDGRID_API_KEY=
# SendGrid webhook signature verification public key (ECDSA)
# Get from SendGrid Event Webhook settings: https://app.sendgrid.com/settings/mail_settings
# Required for webhook signature verification
SENDGRID_WEBHOOK_PUBLIC_KEY=
EMAIL_FROM_ADDRESS=noreply@clipper.gg
EMAIL_FROM_NAME=Clipper
# Sandbox mode for testing - logs emails without actually sending them
# Set to true for local development to test email functionality without sending real emails
EMAIL_SANDBOX_MODE=true
# Maximum emails per user per hour (rate limiting)
EMAIL_MAX_PER_HOUR=10

# ============================================================================
# Embedding Service Configuration (OpenAI)
# ============================================================================
# Get API key from: https://platform.openai.com/api-keys
# Required for semantic search features
# Leave EMBEDDING_ENABLED=false for development unless testing semantic search
EMBEDDING_ENABLED=false
OPENAI_API_KEY=
# Embedding model to use (text-embedding-3-small, text-embedding-3-large, text-embedding-ada-002)
EMBEDDING_MODEL=text-embedding-3-small
# Rate limit for OpenAI API calls (requests per minute)
# Tier 1: 500 RPM, Tier 2: 5000 RPM, adjust based on your tier
EMBEDDING_REQUESTS_PER_MINUTE=500
# Scheduler interval for automatic embedding generation (in minutes)
# Default: 360 minutes (6 hours)
EMBEDDING_SCHEDULER_INTERVAL_MINUTES=360

# ============================================================================
# Feature Flags
# ============================================================================
# Enable/disable features for gradual rollout and testing
# Semantic search requires EMBEDDING_ENABLED=true
FEATURE_SEMANTIC_SEARCH=false
# Premium subscriptions requires STRIPE_SECRET_KEY configured
FEATURE_PREMIUM_SUBSCRIPTIONS=false
# Email notifications requires EMAIL_ENABLED=true
FEATURE_EMAIL_NOTIFICATIONS=false
# Push notifications (mobile app)
FEATURE_PUSH_NOTIFICATIONS=false
# Analytics tracking (enabled by default)
FEATURE_ANALYTICS=true
# Moderation features (enabled by default)
FEATURE_MODERATION=true
# Discovery lists and featured content
FEATURE_DISCOVERY_LISTS=false

# ============================================================================
# Karma System Configuration
# ============================================================================
# Karma points awarded to new users upon registration
# Default: 100 (allows new users to submit clips immediately)
# Set to 0 to require users to earn karma before submitting
KARMA_INITIAL_POINTS=100
# Minimum karma required to submit clips
# Default: 100
# Can be adjusted based on community needs (e.g., 50 for more permissive, 200 for stricter)
KARMA_SUBMISSION_REQUIRED=100
# Whether to enforce karma requirement for clip submissions
# Default: true
# Set to false to allow all authenticated users to submit regardless of karma
KARMA_REQUIRE_FOR_SUBMISSION=true

# ============================================================================
# Background Job Intervals
# ============================================================================
# Interval (in minutes) for refreshing the hot clips materialized view
HOT_CLIPS_REFRESH_INTERVAL_MINUTES=5
# Interval (in minutes) for processing webhook retries
WEBHOOK_RETRY_INTERVAL_MINUTES=1
# Batch size for webhook retry processing per interval
WEBHOOK_RETRY_BATCH_SIZE=100

# ============================================================================
# Rate Limiting Configuration
# ============================================================================
# Rate limits protect the service and ensure fair usage across all users.
# Limits are tiered based on user authentication and subscription status.

# Unauthenticated users (per IP address)
# Default: 100 requests per 15 minutes
RATE_LIMIT_UNAUTH_REQUESTS=100
RATE_LIMIT_UNAUTH_WINDOW_MINUTES=15

# Authenticated basic users (free tier, per user, per hour)
# Default: 1,000 requests per hour
RATE_LIMIT_BASIC_REQUESTS=1000

# Authenticated premium users (pro tier, per user, per hour)
# Default: 5,000 requests per hour (calculated as 5x the basic limit: 5 * RATE_LIMIT_BASIC_REQUESTS = 5,000)
RATE_LIMIT_PREMIUM_REQUESTS=5000

# Endpoint-specific rate limits (per minute)
# GET /api/v1/clips - browsing clips
RATE_LIMIT_CLIPS_LIST=100
# POST /api/v1/clips - creating/claiming clips
RATE_LIMIT_CLIPS_CREATE=10
# GET /api/v1/feed - accessing feed endpoints
RATE_LIMIT_FEED=30
# GET /api/v1/users/{id} - viewing user profiles
RATE_LIMIT_USER_PROFILE=200
# POST /api/v1/clips/:id/comments - creating comments
RATE_LIMIT_COMMENT_CREATE=10
# POST votes - upvoting/downvoting content
RATE_LIMIT_VOTE=20
# POST follow actions - following users/broadcasters/games
RATE_LIMIT_FOLLOW=20
# POST /api/v1/submissions - submitting clips
RATE_LIMIT_SUBMISSION=5
# POST /api/v1/reports - reporting content
RATE_LIMIT_REPORT=10
# GET export endpoints - data exports
RATE_LIMIT_EXPORT=1
# POST account deletion - account deletion requests
RATE_LIMIT_ACCOUNT_DELETION=1

# Note: Admin users bypass all rate limits

# ============================================================================
# Query Complexity Limits (DoS Protection)
# ============================================================================
# These limits prevent resource exhaustion attacks via expensive queries.
# Configured limits protect against denial of service by limiting query complexity.

# Database query limits
# Maximum number of rows that can be returned by a single query
# Default: 1000
QUERY_MAX_RESULT_SIZE=1000

# Maximum pagination offset (prevents inefficient deep pagination)
# Default: 1000
# Note: Large offsets are inefficient; use cursor-based pagination for better performance
QUERY_MAX_OFFSET=1000

# Maximum number of JOIN clauses allowed in a query
# Default: 3
QUERY_MAX_JOIN_DEPTH=3

# Maximum query execution time in seconds
# Default: 10
QUERY_MAX_TIME_SEC=10

# OpenSearch/search query limits
# Maximum number of search results per query
# Default: 100
SEARCH_MAX_RESULT_SIZE=100

# Maximum aggregation bucket size (e.g., terms aggregation)
# Default: 100
SEARCH_MAX_AGGREGATION_SIZE=100

# Maximum nested aggregation depth
# Default: 2
SEARCH_MAX_AGGREGATION_NEST=2

# Maximum number of query clauses in bool queries
# Default: 20
SEARCH_MAX_QUERY_CLAUSES=20

# Maximum search timeout in seconds
# Default: 5
SEARCH_MAX_TIME_SEC=5

# Maximum search pagination offset
# Default: 1000
SEARCH_MAX_OFFSET=1000

# For more information on query limits, see docs/QUERY_LIMITS.md

