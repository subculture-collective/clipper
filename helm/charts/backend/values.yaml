# Default values for clipper-backend
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

replicaCount: 2

image:
  repository: clipper-backend
  pullPolicy: IfNotPresent
  tag: "latest"

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  create: true
  annotations: {}
  name: "clipper-backend"

podAnnotations: {}

podSecurityContext: {}
  # fsGroup: 2000

securityContext: {}
  # capabilities:
  #   drop:
  #   - ALL
  # readOnlyRootFilesystem: true
  # runAsNonRoot: true
  # runAsUser: 1000

service:
  type: ClusterIP
  port: 80
  targetPort: 8080
  annotations: {}

ingress:
  enabled: true
  className: "nginx"
  annotations:
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
  hosts:
    - host: clpr.tv
      paths:
        - path: /api
          pathType: Prefix
  tls:
    - secretName: clipper-tls
      hosts:
        - clpr.tv

resources:
  limits:
    cpu: 500m
    memory: 512Mi
  requests:
    cpu: 100m
    memory: 256Mi

autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 10
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80
  behavior:
    scaleDown:
      stabilizationWindowSeconds: 300
      policies:
        - type: Percent
          value: 50
          periodSeconds: 60
    scaleUp:
      stabilizationWindowSeconds: 0
      policies:
        - type: Percent
          value: 100
          periodSeconds: 30
        - type: Pods
          value: 2
          periodSeconds: 30
      selectPolicy: Max

nodeSelector: {}

tolerations: []

affinity: {}

terminationGracePeriodSeconds: 30

podDisruptionBudget:
  enabled: true
  minAvailable: 1

networkPolicy:
  enabled: true
  policyTypes:
    - Ingress
    - Egress
  ingress:
    - from:
        - namespaceSelector:
            matchLabels:
              name: ingress-nginx
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: ingress-nginx
      ports:
        - protocol: TCP
          port: 8080
  egress:
    - to:
        - podSelector:
            matchLabels:
              app: postgres
      ports:
        - protocol: TCP
          port: 5432
    - to:
        - podSelector:
            matchLabels:
              app: redis
      ports:
        - protocol: TCP
          port: 6379
    - to:
        - podSelector:
            matchLabels:
              app: opensearch
      ports:
        - protocol: TCP
          port: 9200
    - to:
        - namespaceSelector: {}
      ports:
        - protocol: TCP
          port: 443

livenessProbe:
  httpGet:
    path: /health/live
    port: 8080
  initialDelaySeconds: 15
  periodSeconds: 30

readinessProbe:
  httpGet:
    path: /health/ready
    port: 8080
  initialDelaySeconds: 5
  periodSeconds: 15

config:
  PORT: "8080"
  GIN_MODE: "release"
  BASE_URL: "https://clpr.tv"
  ENVIRONMENT: "production"
  DB_HOST: "postgres"
  DB_PORT: "5432"
  DB_USER: "clipper"
  DB_NAME: "clipper_db"
  DB_SSLMODE: "disable"
  REDIS_HOST: "redis"
  REDIS_PORT: "6379"
  REDIS_DB: "0"
  TWITCH_REDIRECT_URI: "https://clpr.tv/api/v1/auth/twitch/callback"
  CORS_ALLOWED_ORIGINS: "https://clpr.tv"
  LOG_LEVEL: "info"
  OPENSEARCH_URL: "http://opensearch:9200"
  OPENSEARCH_INSECURE_SKIP_VERIFY: "false"
  STRIPE_SUCCESS_URL: "https://clpr.tv/subscription/success"
  STRIPE_CANCEL_URL: "https://clpr.tv/subscription/cancel"
  SENTRY_ENABLED: "true"
  SENTRY_ENVIRONMENT: "production"
  SENTRY_TRACES_SAMPLE_RATE: "0.1"
  EMAIL_ENABLED: "false"
  EMAIL_FROM_ADDRESS: "noreply@clpr.tv"
  EMAIL_FROM_NAME: "Clipper"
  EMAIL_MAX_PER_HOUR: "10"
  EMBEDDING_ENABLED: "false"
  EMBEDDING_MODEL: "text-embedding-3-small"
  EMBEDDING_REQUESTS_PER_MINUTE: "500"
  EMBEDDING_SCHEDULER_INTERVAL_MINUTES: "360"
  FEATURE_SEMANTIC_SEARCH: "false"
  FEATURE_PREMIUM_SUBSCRIPTIONS: "false"
  FEATURE_EMAIL_NOTIFICATIONS: "false"
  FEATURE_PUSH_NOTIFICATIONS: "false"
  FEATURE_ANALYTICS: "true"
  FEATURE_MODERATION: "true"
  FEATURE_DISCOVERY_LISTS: "false"
  HOT_CLIPS_REFRESH_INTERVAL_MINUTES: "5"
  WEBHOOK_RETRY_INTERVAL_MINUTES: "1"
  WEBHOOK_RETRY_BATCH_SIZE: "100"

# Secrets should be injected via external secrets operator or sealed secrets
# This is just a placeholder structure
secrets:
  existingSecret: "backend-secrets"
  # If existingSecret is not set, these will be created (NOT RECOMMENDED for production)
  # DB_PASSWORD: ""
  # REDIS_PASSWORD: ""
  # JWT_SECRET: ""
  # etc...
